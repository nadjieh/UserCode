process SingleTop = {

  # initialize MessageLogger
service = MessageLogger {}
//  include "FWCore/MessageLogger/data/MessageLogger.cfi"
  #replace MessageLogger.cerr.threshold = "default"
  # return trigger report (including filter efficiencies)
  #untracked PSet options = { untracked bool wantSummary = true }


  # input
  # input
  source = PoolSource {
    untracked vstring fileNames ={""}
  }
#  source = PoolSource {
#    untracked vstring fileNames ={"file:/data/dkonst/PAT/data/fastsim169_gen_0_999_tbq_ele.root"}
#    #untracked uint32 debugVerbosity = 100
#    #untracked bool   debugFlag     = true
#  }
##  include "TopQuarkAnalysis/SingleTop/test/RecoInput_singletop.cfi"
  include "TopQuarkAnalysis/SingleTop/test/RecoInput_SingleTop.cfi"
  untracked PSet maxEvents = { untracked int32 input = 30 }

  ### MC Tools for CSA07 ###
  module csa07EventWeightProducer = CSA07EventWeightProducer {
     InputTag src = source
     untracked bool talkToMe = false
     double overallLumi = 1000.
     double ttKfactor = 1.0
  }


  ### PAT steering ###

  include "PhysicsTools/PatAlgos/data/famos/aodWithFamos.cff"
  include "PhysicsTools/PatAlgos/data/famos/famosSequences.cff"
  include "PhysicsTools/PatAlgos/data/patLayer0.cff"
  #include "PhysicsTools/PatAlgos/test/patLayer0_ReplaceDefaults_fast.cff"
  // when not using the replaces, you need the following instead
  include "PhysicsTools/PatAlgos/data/famos/patLayer0_FamosSetup.cff"
  include "PhysicsTools/PatAlgos/data/patLayer1.cff"
  #include "PhysicsTools/PatAlgos/test/patLayer1_ReplaceDefaults_fast.cff"
  // when not using the replaces, you need the following instead
  include "PhysicsTools/PatAlgos/data/famos/patLayer1_FamosSetup.cff"

  replace selectedLayer1Jets.cut = "et > 10. & abs(eta) < 12 & nConstituents > 0"

  # PAT object filters
  replace countLayer1Leptons.minNumber = 1
  replace countLayer1Leptons.maxNumber = 99
  replace countLayer1Leptons.countElectrons = false
  replace countLayer1Leptons.countMuons = true
  replace countLayer1Leptons.countTaus = false
  # at least one jet:
  replace minLayer1Jets.minNumber = 2

  ### kit ###

  # SingleTop (layer 2)
  include "TopQuarkAnalysis/SingleTop/test/SingleTop.cfi"
  replace SingleTop.isCSA07Soup        = false
  replace SingleTop.verbosity          = 200
  replace SingleTop.isFullSim          = false

  ### Debug ###
  module dump = EventContentAnalyzer { untracked int32 debugLevel = 2 }

  ### Output ###

  path p = {
    patExtraOn168FastAOD,
#    patLayer0_withoutPFTau,
    patLayer0_withoutTrigMatch_withoutPFTau,
    patLayer1,
    SingleTop
#    dump
  }

  # to only accept events passing the complete path
  block EventSelection = {
    untracked PSet SelectEvents = {
      vstring SelectEvents = { "p" }
    }
  }


  # define the event content
  block patEventContent = {
    untracked vstring outputCommands = {
   #   "drop *"
    }
  }
  include "PhysicsTools/PatAlgos/data/patLayer1_EventContent.cff"
  replace patEventContent.outputCommands += patLayer1EventContent.outputCommands

  replace patEventContent.outputCommands += {
    "drop patPhotons_*_*_*",
    "drop patTaus_*_*_*",
    "drop patHemispheres_*_*_*",
    "keep *_SingleTop_*_*"
  }

  # only accept events passing the complete path
  block patEventSelection = {
    untracked PSet SelectEvents = {
      vstring SelectEvents = { "p" }
    }
  }

  module out = PoolOutputModule {
    untracked string fileName = "SingleTopSkim.root"
    using patEventSelection
    using patEventContent
    untracked bool verbose = false
  }


  endpath outpath = { out }
}
